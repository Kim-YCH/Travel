<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>å‡ºç™¼å›‰</title>
Â  Â  <meta name="apple-mobile-web-app-capable" content="yes">
Â  Â  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
Â  Â Â 
Â  Â  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f0f2f5; user-select: none; padding-bottom: env(safe-area-inset-bottom); }
Â  Â  Â  Â  .card { background: white; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
Â  Â  Â  Â  .tap-highlight-transparent { -webkit-tap-highlight-color: transparent; }
Â  Â  Â  Â  input, select, textarea { -webkit-user-select: text; user-select: text; }
Â  Â  Â  Â  .day-tab-active { background: #2563eb; color: white; border-color: #2563eb; }
Â  Â  Â  Â  .day-tab-inactive { background: white; color: #6b7280; border-color: #e5e7eb; }
Â  Â  Â  Â  .no-scrollbar::-webkit-scrollbar { display: none; } .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
Â  Â  Â  Â  .loading-bar { position: fixed; top: 0; left: 0; right: 0; height: 3px; background: #2563eb; z-index: 9999; animation: loading 1s infinite linear; }
Â  Â  Â  Â  @keyframes loading { 0% { width: 0%; left: 0; } 50% { width: 50%; left: 25%; } 100% { width: 100%; left: 100%; } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Google Maps å®¹å™¨ */
Â  Â  Â  Â  #map { height: 100%; width: 100%; z-index: 1; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* æœå°‹å»ºè­°åˆ—è¡¨ */
Â  Â  Â  Â  .suggestions-list { position: absolute; top: 100%; left: 0; right: 0; background: white; z-index: 50; max-height: 250px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; margin-top: 4px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
Â  Â  Â  Â  .suggestion-item { padding: 12px; border-bottom: 1px solid #f3f4f6; display: flex; align-items: center; gap: 8px; cursor: pointer; }
Â  Â  Â  Â  .suggestion-item:hover { background-color: #eff6ff; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Checkbox å„ªåŒ– */
Â  Â  Â  Â  .checkbox-wrapper input:checked + div { background-color: #dbeafe; color: #1e40af; border-color: #2563eb; font-weight: bold; }
Â  Â  Â  Â  .checkbox-wrapper div { color: #111827; font-weight: 500; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Google Logo ä¿®æ­£ (é¿å…è¢«å…¨åŸŸæ¨£å¼éš±è—) */
Â  Â  Â  Â  .gmnoprint a, .gmnoprint span, .gm-style-cc { display:none; }Â 
Â  Â  Â  Â  img[src*="google"] { display: inline !important; }
Â  Â  </style>
</head>
<body>
<div id="app" class="max-w-md mx-auto min-h-screen flex flex-col h-screen">
Â  Â  <div v-if="isLoading" class="loading-bar"></div>

Â  Â  <div v-if="currentView === 'lobby'" class="flex-1 p-6 flex flex-col justify-center bg-gray-50">
Â  Â  Â  Â  <h1 class="text-3xl font-bold text-gray-900 mb-2">âœˆï¸ å‡ºç™¼å›‰</h1>

Â  Â  Â  Â  <div class="space-y-4 mb-8 overflow-y-auto max-h-[60vh]">
Â  Â  Â  Â  Â  Â  <div v-for="trip in trips" :key="trip.id" @click="selectTrip(trip)" class="card p-5 flex justify-between items-center active:scale-95 transition cursor-pointer border-l-4 border-blue-500 hover:shadow-md">
Â  Â  Â  Â  Â  Â  Â  Â  <div><div class="font-bold text-xl text-gray-900">{{ trip.name }}</div><div class="text-sm text-gray-500">ğŸ“ {{ trip.city }}</div></div><div class="text-2xl text-gray-300">âœ</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div v-if="trips.length === 0" class="text-center text-gray-400 py-10">é‚„æ²’æœ‰æ—…ç¨‹ï¼ŒæŒ‰ä¸‹æ–¹æ–°å¢</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card p-4 border border-blue-100">
Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-gray-700 mb-3">æ–°å¢æ—…ç¨‹</h3>
Â  Â  Â  Â  Â  Â  <input v-model="newTripName" placeholder="æ—…ç¨‹åç¨±" class="w-full bg-gray-100 p-3 rounded-lg mb-2 outline-none text-gray-900">
Â  Â  Â  Â  Â  Â  <input v-model="newTripCity" placeholder="ä¸»è¦åŸå¸‚" class="w-full bg-gray-100 p-3 rounded-lg mb-3 outline-none text-gray-900">
Â  Â  Â  Â  Â  Â  <button @click="createTrip" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold shadow disabled:opacity-50" :disabled="!newTripName || isLoading">å»ºç«‹æ–°æ—…ç¨‹</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div v-else class="flex flex-col h-full">
Â  Â  Â  Â  <header class="bg-blue-600 text-white p-4 pt-12 pb-4 shadow-md sticky top-0 z-50 flex justify-between items-center flex-shrink-0">
Â  Â  Â  Â  Â  Â  <div><h1 class="text-lg font-bold tracking-wide">å‡ºç™¼å›‰ï¼š{{ currentTrip.name }}</h1><div class="text-xs text-blue-200">Day {{ currentDay }} | {{ currentTrip.city }}</div></div>
Â  Â  Â  Â  Â  Â  <button @click="fetchData" class="text-xs bg-blue-700 px-3 py-1 rounded-full text-blue-100 active:scale-95">â†» åŒæ­¥</button>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <main class="flex-1 overflow-hidden flex flex-col relative bg-gray-50">
Â  Â  Â  Â  Â  Â  <div v-if="currentTab === 'itinerary'" class="p-4 overflow-y-auto flex-1 space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex overflow-x-auto pb-2 gap-2 no-scrollbar items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button v-for="d in totalDays" :key="d" @click="currentDay = d" class="px-4 py-2 rounded-full border text-sm font-bold whitespace-nowrap transition flex-shrink-0" :class="currentDay === d ? 'day-tab-active' : 'day-tab-inactive'">Day {{ d }}</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @click="addNewDay" class="px-3 py-2 rounded-full border border-gray-300 bg-white font-bold flex-shrink-0">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card p-4 space-y-2 relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2 relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input v-model="newPlace" @input="searchPlacesInput" type="text" :placeholder="'æœå°‹ ' + currentTrip.city + ' åœ°é»...'" class="flex-1 border-0 bg-gray-100 p-3 rounded-lg outline-none font-bold text-gray-900">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @click="addPlace" class="bg-blue-600 text-white w-12 rounded-lg text-2xl shadow active:scale-95 transition" :disabled="isLoading">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div v-if="newPlace.length > 0 && searchResults.length > 0" class="suggestions-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div v-for="item in searchResults" :key="item.place_id" @click="selectPlace(item)" class="suggestion-item hover:bg-blue-50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xl">ğŸ“</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="overflow-hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-gray-800 text-sm truncate">{{ item.structured_formatting.main_text }}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-gray-500 truncate">{{ item.structured_formatting.secondary_text }}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-2 text-xs text-center text-gray-400 bg-gray-50">Powered by Google</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input v-model="newNote" type="text" placeholder="å‚™è¨»..." class="w-full border-0 bg-gray-50 p-2 rounded-lg outline-none text-sm text-gray-900">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3 pb-20">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div v-for="place in filteredItinerary" :key="place.id" class="card p-4 flex justify-between items-start active:scale-[0.99] transition">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1" @click="openGoogleMap(place)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-gray-800 text-lg">{{ place.name }}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span v-if="place.lat" class="text-[10px] text-green-600 bg-green-100 px-1 rounded">Google</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div v-if="place.message" class="text-sm text-gray-500 mt-1 bg-gray-50 p-1 rounded inline-block">ğŸ“ {{ place.message }}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @click.stop="removePlace(place.id)" class="text-gray-300 hover:text-red-500 px-2 text-xl" :disabled="isLoading">Ã—</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div v-if="filteredItinerary.length===0" class="text-center text-gray-400 mt-10">å°šç„¡è¡Œç¨‹</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div v-show="currentTab === 'map'" class="absolute inset-0 flex flex-col z-10">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="map" class="flex-1 bg-gray-100"></div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute top-4 left-4 right-4 z-[10] flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @click="fitBoundsToTrip" class="flex-1 bg-white text-gray-700 font-bold py-3 rounded-lg shadow-lg border border-gray-100 active:scale-95 text-sm flex justify-center items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸ“</span> é¡¯ç¤ºæ‰€æœ‰è¡Œç¨‹
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div v-if="currentTab === 'money'" class="p-4 overflow-y-auto space-y-4 pb-24">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card p-4 bg-gradient-to-r from-gray-800 to-gray-700 text-white shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-end mb-4"><span class="text-gray-300 text-sm">ç¸½æ”¯å‡º</span><span class="text-2xl font-bold">${{ totalExpense }}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2 border-t border-gray-600 pt-3"><div v-for="res in balanceSheet" :key="res.name" class="flex justify-between text-sm"><span>{{ res.name }}</span><span :class="res.balance >= 0 ? 'text-green-300' : 'text-red-300'" class="font-mono font-bold">${{ Math.abs(res.balance).toFixed(0) }}</span></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card p-4 border border-blue-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-3 gap-2 mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input v-model="newExpense.title" placeholder="é …ç›®" class="col-span-2 bg-gray-50 p-3 rounded-lg border-0 ring-1 ring-gray-200 outline-none text-gray-900">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input v-model.number="newExpense.amount" type="number" placeholder="$" class="bg-gray-50 p-3 rounded-lg border-0 ring-1 ring-gray-200 outline-none text-gray-900">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-3 flex gap-2 items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs text-gray-500 w-12">ä»˜æ¬¾äºº</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select v-model="newExpense.payer" class="flex-1 bg-gray-50 p-2 rounded border-0 ring-1 ring-gray-200 text-gray-900">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option disabled value="">è«‹é¸æ“‡ä»˜æ¬¾äºº</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option v-for="(p, index) in people" :value="p.name">{{ p.name || 'æˆå“¡ ' + (index+1) }}</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs text-gray-500 block mb-1">åˆ†æ”¤çµ¦ (é»æ“Šåˆ‡æ›)</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label v-for="(p, index) in people" :key="p.id" class="checkbox-wrapper cursor-pointer relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" :value="p.name" v-model="newExpense.involved" class="absolute opacity-0 w-0 h-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="px-3 py-1 rounded-full border border-gray-200 text-sm bg-white transition select-none text-gray-900">{{ p.name || 'æˆå“¡ ' + (index+1) }}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @click="addExpense" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold shadow" :disabled="isLoading">è¨˜å¸³</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div v-for="(exp, idx) in expenses" :key="exp.id" class="bg-white p-3 rounded-lg shadow-sm border-l-4 border-blue-500 flex justify-between items-start">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-gray-800 text-lg">{{ exp.title }}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs mt-1 space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-1"><span class="bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded font-bold">å…ˆä»˜</span><span class="text-gray-700 font-medium">{{ exp.payer || 'æœªçŸ¥' }}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-1 flex-wrap"><span class="bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded">åˆ†æ”¤</span><span class="text-gray-500">{{ formatInvolved(exp.involved) }}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col items-end gap-2"><span class="font-bold text-xl text-gray-800">${{ exp.amount }}</span><button @click="removeExpense(idx)" class="text-gray-300 hover:text-red-500 px-2 text-xl">Ã—</button></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div v-if="currentTab === 'settings'" class="p-4 space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button @click="exitTrip" class="w-full bg-gray-800 text-white py-3 rounded-lg font-bold mb-6">ğŸ”™ åˆ‡æ›æ—…ç¨‹ (å›åˆ°å¤§å»³)</button>
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-gray-700">ğŸ‘¥ æˆå“¡ç®¡ç†</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2"><input v-model="newPerson" placeholder="åå­—" class="flex-1 bg-gray-100 p-2 rounded text-gray-900"><button @click="addPerson" class="bg-gray-800 text-white px-4 rounded">æ–°å¢</button></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2 mb-10"><div v-for="(p, idx) in people" :key="p.id" class="flex justify-between items-center p-3 bg-gray-50 rounded border border-gray-100"><span class="font-medium text-gray-900">{{ p.name || 'æˆå“¡ ' + (idx + 1) }}</span><button @click="removePerson(idx)" class="text-red-400 font-bold">ç§»é™¤</button></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="border-t pt-4 mt-4 text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @click="resetTrip" class="w-full bg-red-50 text-red-600 border border-red-200 py-3 rounded-lg font-bold">ğŸ—‘ï¸ åˆªé™¤æ­¤æ—…ç¨‹è³‡æ–™</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @click="deleteTripTotally" class="w-full mt-2 text-gray-400 text-xs py-2">âŒ ç§»é™¤æ­¤æ—…ç¨‹å¡ç‰‡</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </main>

Â  Â  Â  Â  <nav class="bg-white border-t flex justify-around pb-safe pt-2 pb-2 z-50 flex-shrink-0">
Â  Â  Â  Â  Â  Â  <button @click="switchTab('itinerary')" class="flex flex-col items-center w-full" :class="currentTab==='itinerary'?'text-blue-600':'text-gray-400'"><span class="text-xl">ğŸ“</span><span class="text-xs">è¡Œç¨‹</span></button>
Â  Â  Â  Â  Â  Â  <button @click="switchTab('map')" class="flex flex-col items-center w-full" :class="currentTab==='map'?'text-purple-600':'text-gray-400'"><span class="text-xl">ğŸ—ºï¸</span><span class="text-xs">åœ°åœ–</span></button>
Â  Â  Â  Â  Â  Â  <button @click="switchTab('money')" class="flex flex-col items-center w-full" :class="currentTab==='money'?'text-green-600':'text-gray-400'"><span class="text-xl">ğŸ’°</span><span class="text-xs">åˆ†å¸³</span></button>
Â  Â  Â  Â  Â  Â  <button @click="switchTab('settings')" class="flex flex-col items-center w-full" :class="currentTab==='settings'?'text-gray-600':'text-gray-400'"><span class="text-xl">âš™ï¸</span><span class="text-xs">è¨­å®š</span></button>
Â  Â  Â  Â  </nav>
Â  Â  </div>
</div>

<script>
Â  Â  const { createApp, ref, computed, onMounted, nextTick } = Vue;
Â  Â  createApp({
Â  Â  Â  Â  setup() {
Â  Â  Â  Â  Â  Â  // â˜…â˜…â˜… 1. æ‚¨çš„ GAS ç¶²å€ (å·²è‡ªå‹•å¡«å…¥) â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  const API_URL = 'https://script.google.com/macros/s/AKfycby303KH-yL7YZajdYUwBQEW-lyFmhz5qsCL5KrY73fZSS5wmSfjPZX8qCYxaNP3FnM/exec';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // â˜…â˜…â˜… 2. æ‚¨çš„ Google Maps API Key (è«‹åœ¨é€™è£¡è²¼ä¸Š) â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  const GOOGLE_MAPS_API_KEY = 'AIzaSyCLrHk9V-eQby0aDVx31iwFyqmhI-jIs4Q';

Â  Â  Â  Â  Â  Â  // State
Â  Â  Â  Â  Â  Â  const currentView = ref('lobby');Â 
Â  Â  Â  Â  Â  Â  const currentTrip = ref(null);
Â  Â  Â  Â  Â  Â  const trips = ref([]);
Â  Â  Â  Â  Â  Â  const newTripName = ref('');
Â  Â  Â  Â  Â  Â  const newTripCity = ref('');
Â  Â  Â  Â  Â  Â  const currentTab = ref('itinerary');
Â  Â  Â  Â  Â  Â  const isLoading = ref(false);
Â  Â  Â  Â  Â  Â  const currentDay = ref(1);
Â  Â  Â  Â  Â  Â  const totalDays = ref(1);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const people = ref([]);
Â  Â  Â  Â  Â  Â  const itinerary = ref([]);
Â  Â  Â  Â  Â  Â  const expenses = ref([]);

Â  Â  Â  Â  Â  Â  const newPlace = ref('');
Â  Â  Â  Â  Â  Â  const newNote = ref('');
Â  Â  Â  Â  Â  Â  const newPerson = ref('');
Â  Â  Â  Â  Â  Â  const newExpense = ref({ title: '', amount: '', payer: '', involved: [] });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const searchResults = ref([]);
Â  Â  Â  Â  Â  Â  const selectedPlaceData = ref(null);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Google Maps Variables
Â  Â  Â  Â  Â  Â  let googleMap = null;
Â  Â  Â  Â  Â  Â  let autocompleteService = null;
Â  Â  Â  Â  Â  Â  let markers = [];
Â  Â  Â  Â  Â  Â  let infoWindow = null;

Â  Â  Â  Â  Â  Â  const generateId = () => Date.now() + '_' + Math.floor(Math.random() * 1000);
Â  Â  Â  Â  Â  Â  const formatInvolved = (list) => (!list || list.length === 0) ? 'å…¨å“¡' : (Array.isArray(list) ? list.join(', ') : list);

Â  Â  Â  Â  Â  Â  // --- Google Maps Loader ---
Â  Â  Â  Â  Â  Â  const loadGoogleMaps = () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (window.google && window.google.maps) return Promise.resolve();
Â  Â  Â  Â  Â  Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const script = document.createElement('script');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places&language=zh-TW`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  script.async = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  script.defer = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  script.onload = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  autocompleteService = new google.maps.places.AutocompleteService();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resolve();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  script.onerror = reject;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.head.appendChild(script);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  onMounted(() => {
Â  Â  Â  Â  Â  Â  Â  Â  fetchTrips();
Â  Â  Â  Â  Â  Â  Â  Â  loadGoogleMaps();
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // --- Search Logic (Google Places) ---
Â  Â  Â  Â  Â  Â  const searchPlacesInput = () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!newPlace.value || !autocompleteService) { searchResults.value = []; return; }
Â  Â  Â  Â  Â  Â  Â  Â  const request = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input: newPlace.value,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // å¦‚æœæœ‰é–å®šåŸå¸‚ï¼Œå¯ä»¥é€é bias ç¨å¾®å¼•å°
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  autocompleteService.getPlacePredictions(request, (predictions, status) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (status === google.maps.places.PlacesServiceStatus.OK && predictions) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  searchResults.value = predictions;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  searchResults.value = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const selectPlace = (item) => {
Â  Â  Â  Â  Â  Â  Â  Â  newPlace.value = item.structured_formatting.main_text;
Â  Â  Â  Â  Â  Â  Â  Â  selectedPlaceData.value = item;
Â  Â  Â  Â  Â  Â  Â  Â  searchResults.value = [];
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // --- Core Logic ---
Â  Â  Â  Â  Â  Â  const addPlace = async () => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!newPlace.value.trim()) return;
Â  Â  Â  Â  Â  Â  Â  Â  const id = generateId();
Â  Â  Â  Â  Â  Â  Â  Â  const d = currentDay.value;
Â  Â  Â  Â  Â  Â  Â  Â  const placeName = newPlace.value;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let lat = null;
Â  Â  Â  Â  Â  Â  Â  Â  let lng = null;
Â  Â  Â  Â  Â  Â  Â  Â  let placeId = null;

Â  Â  Â  Â  Â  Â  Â  Â  // å¦‚æœæ˜¯é€éé¸å–®é¸çš„ï¼Œä½¿ç”¨ Places Service ç²å–è©³ç´°åº§æ¨™
Â  Â  Â  Â  Â  Â  Â  Â  if (selectedPlaceData.value && window.google) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeId = selectedPlaceData.value.place_id;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dummyMap = new google.maps.Map(document.createElement('div'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const service = new google.maps.places.PlacesService(dummyMap);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await new Promise((resolve) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  service.getDetails({ placeId: placeId }, (place, status) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (status === google.maps.places.PlacesServiceStatus.OK) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lat = place.geometry.location.lat();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lng = place.geometry.location.lng();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resolve();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) { console.error("Google Detail Error", e); }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const item = { id, name: placeName, day: d, lat, lng, place_id: placeId, message: newNote.value || '' };
Â  Â  Â  Â  Â  Â  Â  Â  itinerary.value.push(item);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  newPlace.value = ''; newNote.value = ''; selectedPlaceData.value = null; searchResults.value = [];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  await sendToApi('add', 'itinerary', item);
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // --- Map Tab Logic ---
Â  Â  Â  Â  Â  Â  const switchTab = (tab) => {
Â  Â  Â  Â  Â  Â  Â  Â  currentTab.value = tab;
Â  Â  Â  Â  Â  Â  Â  Â  if(tab === 'map') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nextTick(() => initGoogleMap());
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const initGoogleMap = () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!window.google) return;
Â  Â  Â  Â  Â  Â  Â  Â  const mapEl = document.getElementById('map');
Â  Â  Â  Â  Â  Â  Â  Â  if (!mapEl) return;

Â  Â  Â  Â  Â  Â  Â  Â  if (!googleMap) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  googleMap = new google.maps.Map(mapEl, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  center: { lat: 23.6, lng: 121 },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  zoom: 8,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  streetViewControl: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mapTypeControl: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fullscreenControl: false
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoWindow = new google.maps.InfoWindow();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  updateMapMarkers();
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const updateMapMarkers = () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!googleMap) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  markers.forEach(m => m.setMap(null));
Â  Â  Â  Â  Â  Â  Â  Â  markers = [];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const bounds = new google.maps.LatLngBounds();
Â  Â  Â  Â  Â  Â  Â  Â  let hasPoint = false;

Â  Â  Â  Â  Â  Â  Â  Â  const validPoints = itinerary.value.filter(i => i.lat && i.lng);

Â  Â  Â  Â  Â  Â  Â  Â  validPoints.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const d = item.day ? parseInt(item.day) : 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const marker = new google.maps.Marker({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: { lat: Number(item.lat), lng: Number(item.lng) },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map: googleMap,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: { text: d.toString(), color: "white" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: item.name
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.addListener("click", () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const content = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="padding:5px; color:black">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <b>Day ${d}: ${item.name}</b><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size:12px; color:#555">${item.message || 'ç„¡å‚™è¨»'}</span><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.name)}&query_place_id=${item.place_id||''}" target="_blank" style="color:blue; font-size:12px;">åœ¨ Google Maps æŸ¥çœ‹</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoWindow.setContent(content);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoWindow.open(googleMap, marker);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  markers.push(marker);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bounds.extend(marker.getPosition());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hasPoint = true;
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (hasPoint) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  googleMap.fitBounds(bounds);
Â  Â  Â  Â  Â  Â  Â  Â  } else if (currentTrip.value && currentTrip.value.city) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const geocoder = new google.maps.Geocoder();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  geocoder.geocode({ address: currentTrip.value.city }, (results, status) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (status === 'OK' && results[0]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  googleMap.setCenter(results[0].geometry.location);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  googleMap.setZoom(12);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const fitBoundsToTrip = () => updateMapMarkers();

Â  Â  Â  Â  Â  Â  // --- Other Logic ---
Â  Â  Â  Â  Â  Â  const fetchTrips = async () => { isLoading.value = true; try { const res = await fetch(`${API_URL}?type=trips`); trips.value = await res.json(); } catch(e) {} finally { isLoading.value = false; } };
Â  Â  Â  Â  Â  Â  const createTrip = async () => { if(!newTripName.value) return; const id = generateId(); const newTrip = { id, name: newTripName.value, city: newTripCity.value || '' }; trips.value.push(newTrip); newTripName.value = ''; newTripCity.value = ''; await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'add', type: 'trips', data: newTrip }) }); };
Â  Â  Â  Â  Â  Â  const selectTrip = (trip) => { currentTrip.value = trip; currentView.value = 'app'; itinerary.value = []; expenses.value = []; people.value = []; currentDay.value = 1; totalDays.value = 1; fetchData(); };
Â  Â  Â  Â  Â  Â  const deleteTripTotally = async () => { if(!confirm('ç¢ºå®šç§»é™¤ï¼Ÿ')) return; await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'del', type: 'trips', id: currentTrip.value.id }) }); exitTrip(); fetchTrips(); };
Â  Â  Â  Â  Â  Â  const exitTrip = () => { currentView.value = 'lobby'; currentTrip.value = null; fetchTrips(); };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const fetchData = async () => { if(!currentTrip.value) return; isLoading.value = true; const tripId = currentTrip.value.id; try { const [resItin, resExp, resPpl] = await Promise.all([ fetch(`${API_URL}?type=itinerary&tripId=${tripId}`), fetch(`${API_URL}?type=expenses&tripId=${tripId}`), fetch(`${API_URL}?type=people&tripId=${tripId}`) ]); const itinData = await resItin.json(); itinerary.value = itinData; if(itinData.length > 0) { const max = itinData.reduce((m, i) => Math.max(m, i.day ? parseInt(i.day) : 1), 1); if(max > totalDays.value) totalDays.value = max; } expenses.value = await resExp.json(); const ppl = await resPpl.json(); people.value = ppl.length ? ppl : [{id:'default', name:'æˆ‘'}]; if(people.value.length) { newExpense.value.payer = people.value[0].name; newExpense.value.involved = people.value.map(p=>p.name); } } catch(e) {} finally { isLoading.value = false; } };
Â  Â  Â  Â  Â  Â  const sendToApi = async (action, type, data) => { const body = { action, type }; if (action === 'add') { data.trip_id = currentTrip.value.id; body.data = data; } else { body.id = data; } await fetch(API_URL, { method: 'POST', body: JSON.stringify(body) }); };
Â  Â  Â  Â  Â  Â  const removePlace = async(id) => { const i=itinerary.value.findIndex(x=>x.id===id); if(i!==-1) { itinerary.value.splice(i,1); await sendToApi('del', 'itinerary', id); updateMapMarkers(); } };
Â  Â  Â  Â  Â  Â  const addNewDay = () => { totalDays.value++; currentDay.value = totalDays.value; };
Â  Â  Â  Â  Â  Â  // é–‹å•Ÿ Google Maps å°èˆª
Â  Â  Â  Â  Â  Â  const openGoogleMap = (p) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (p.place_id) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.name)}&query_place_id=${p.place_id}`, '_blank');
Â  Â  Â  Â  Â  Â  Â  Â  } else if (p.lat && p.lng) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.open(`https://www.google.com/maps/search/?api=1&query=${p.lat},${p.lng}`, '_blank');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.name + ' ' + currentTrip.value.city)}`, '_blank');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  const addExpense = async () => { if (!newExpense.value.title || !newExpense.value.amount) return; const uid = generateId(); const d = { id: uid, ...newExpense.value, involved: [...newExpense.value.involved] }; expenses.value.unshift(d); await sendToApi('add', 'expenses', { ...d, involved: d.involved.join(',') }); newExpense.value = { title: '', amount: '', payer: people.value[0]?.name||'', involved: people.value.map(p=>p.name) }; };
Â  Â  Â  Â  Â  Â  const removeExpense = async (idx) => { const item = expenses.value[idx]; if (!item.id) return; expenses.value.splice(idx, 1); await sendToApi('del', 'expenses', item.id); };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // â˜…â˜…â˜… v21.0 ä¿®å¾©å¾Œçš„ addPerson â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  const addPerson = async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const name = newPerson.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if (!name) return;
Â  Â  Â  Â  Â  Â  Â  Â  const uid = generateId();
Â  Â  Â  Â  Â  Â  Â  Â  people.value.push({ id: uid, name: name });
Â  Â  Â  Â  Â  Â  Â  Â  newExpense.value.involved.push(name);
Â  Â  Â  Â  Â  Â  Â  Â  newPerson.value = ''; // å…ˆæ¸…ç©º
Â  Â  Â  Â  Â  Â  Â  Â  await sendToApi('add', 'people', { id: uid, name: name }); // å†é€å‡ºæ­£ç¢ºçš„ name
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const removePerson = async (idx) => { const item = people.value[idx]; if (!item.id || !confirm('ç§»é™¤ï¼Ÿ')) return; people.value.splice(idx, 1); await sendToApi('del', 'people', item.id); };
Â  Â  Â  Â  Â  Â  const resetTrip = async () => { if(!confirm('è­¦å‘Šï¼šç¢ºå®šè¦æ¸…ç©ºå—ï¼Ÿ')) return; await fetch(API_URL, {method:'POST', body:JSON.stringify({action:'reset_trip', type:'all', tripId: currentTrip.value.id})}); itinerary.value=[]; expenses.value=[]; people.value=[{id:'def',name:'æˆ‘'}]; alert('å·²æ¸…ç©º'); };
Â  Â  Â  Â  Â  Â  const totalExpense = computed(() => expenses.value.reduce((s,i)=>s+(Number(i.amount)||0),0));
Â  Â  Â  Â  Â  Â  const balanceSheet = computed(() => { if(!people.value.length) return []; let b={}; people.value.forEach(p=>b[p.name]=0); expenses.value.forEach(e=>{ const amt=Number(e.amount)||0; if(b[e.payer]===undefined) return; b[e.payer]+=amt; const inv=(e.involved&&e.involved.length)?e.involved:people.value.map(p=>p.name); const v=inv.filter(n=>b[n]!==undefined); if(v.length) { const s=amt/v.length; v.forEach(n=>b[n]-=s); } }); return Object.keys(b).map(n=>({name:n, balance:b[n]})); });

Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  currentView, currentTrip, trips, newTripName, newTripCity, createTrip, selectTrip, exitTrip, deleteTripTotally,
Â  Â  Â  Â  Â  Â  Â  Â  currentTab, switchTab, isLoading, currentDay, totalDays, addNewDay,
Â  Â  Â  Â  Â  Â  Â  Â  people, itinerary, expenses, filteredItinerary: computed(()=>itinerary.value.filter(i=>(i.day?parseInt(i.day):1)===currentDay.value)),
Â  Â  Â  Â  Â  Â  Â  Â  newPlace, newNote, newPerson, newExpense,Â 
Â  Â  Â  Â  Â  Â  Â  Â  searchResults, searchPlacesInput, selectPlace,
Â  Â  Â  Â  Â  Â  Â  Â  addPlace, removePlace, openGoogleMap, fitBoundsToTrip,
Â  Â  Â  Â  Â  Â  Â  Â  addExpense, removeExpense, addPerson, removePerson, resetTrip,
Â  Â  Â  Â  Â  Â  Â  Â  totalExpense, balanceSheet, fetchData, formatInvolved
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }
Â  Â  }).mount('#app');
</script>
</body>
</html>



